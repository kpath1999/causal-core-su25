[AutoCaLC-CPDRL] Evaluating intervention: goal
autocalc_cpdrl.py:126: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at ../torch/csrc/utils/tensor_new.cpp:230.)
  states = torch.tensor([d[0] for d in data], dtype=torch.float32).to(device)
  Reward: -0.0929, CM: 2.4695
[AutoCaLC-CPDRL] Evaluating intervention: mass
  Reward: -0.1982, CM: 2.2037
[AutoCaLC-CPDRL] Evaluating intervention: friction
  Reward: 0.0035, CM: 2.4802
[AutoCaLC-CPDRL] Evaluating intervention: visual
  Reward: -0.1894, CM: 2.5726
[AutoCaLC-CPDRL] Evaluating intervention: joints
WARNING:root:Applying intervention lead to infeasibility of the robot
WARNING:root:Invalid Intervention was just executed!
  Reward: -0.4747, CM: 2.4071
[AutoCaLC-CPDRL] Evaluating intervention: pose
  Reward: 0.3573, CM: 2.2970
[AutoCaLC-CPDRL] Evaluating intervention: random
  Reward: 0.1224, CM: 2.4034

[AutoCaLC-CPDRL] Adaptive weights: w_p=0.489, w_cm=0.511

[AutoCaLC-CPDRL] Intervention ranking (adaptive weights):
  1. pose | Score: 1.3483 | Reward: 0.3573 | CM: 2.2970
  2. random | Score: 1.2877 | Reward: 0.1224 | CM: 2.4034
  3. friction | Score: 1.2688 | Reward: 0.0035 | CM: 2.4802
  4. visual | Score: 1.2217 | Reward: -0.1894 | CM: 2.5726
  5. goal | Score: 1.2162 | Reward: -0.0929 | CM: 2.4695
  6. mass | Score: 1.0289 | Reward: -0.1982 | CM: 2.2037
  7. joints | Score: 0.9976 | Reward: -0.4747 | CM: 2.4071

[AutoCaLC-CPDRL] === Training on intervention pose (rank 1) ===
Logging to autocalc_cpdrl_logs/PPO_2
[34m[1mwandb[0m: [33mWARNING[0m Step cannot be set when using tensorboard syncing. Please use `run.define_metric(...)` to define a custom metric to log your step values.
-----------------------------
| time/              |      |
|    fps             | 314  |
|    iterations      | 1    |
|    time_elapsed    | 6    |
|    total_timesteps | 2048 |
-----------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 203         |
|    iterations           | 2           |
|    time_elapsed         | 20          |
|    total_timesteps      | 4096        |
| train/                  |             |
|    approx_kl            | 0.037801716 |
|    clip_fraction        | 0.482       |
|    clip_range           | 0.2         |
|    entropy_loss         | -21.6       |
|    explained_variance   | 0.451       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.554      |
|    n_updates            | 1170        |
|    policy_gradient_loss | -0.116      |
|    std                  | 2.66        |
|    value_loss           | 0.0426      |
-----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 182         |
|    iterations           | 3           |
|    time_elapsed         | 33          |
|    total_timesteps      | 6144        |
| train/                  |             |
|    approx_kl            | 0.047504127 |
|    clip_fraction        | 0.537       |
|    clip_range           | 0.2         |
|    entropy_loss         | -21.6       |
|    explained_variance   | 0.691       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.556      |
|    n_updates            | 1185        |
|    policy_gradient_loss | -0.113      |
|    std                  | 2.67        |
|    value_loss           | 0.0218      |
-----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 181         |
|    iterations           | 4           |
|    time_elapsed         | 45          |
|    total_timesteps      | 8192        |
| train/                  |             |
|    approx_kl            | 0.043570876 |
|    clip_fraction        | 0.531       |
|    clip_range           | 0.2         |
|    entropy_loss         | -21.7       |
|    explained_variance   | 0.66        |
|    learning_rate        | 0.00025     |
|    loss                 | -0.533      |
|    n_updates            | 1200        |
|    policy_gradient_loss | -0.109      |
|    std                  | 2.69        |
|    value_loss           | 0.035       |
-----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 180         |
|    iterations           | 5           |
|    time_elapsed         | 56          |
|    total_timesteps      | 10240       |
| train/                  |             |
|    approx_kl            | 0.049657904 |
|    clip_fraction        | 0.512       |
|    clip_range           | 0.2         |
|    entropy_loss         | -21.7       |
|    explained_variance   | 0.638       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.525      |
|    n_updates            | 1215        |
|    policy_gradient_loss | -0.107      |
|    std                  | 2.71        |
|    value_loss           | 0.0431      |
-----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 177         |
|    iterations           | 6           |
|    time_elapsed         | 69          |
|    total_timesteps      | 12288       |
| train/                  |             |
|    approx_kl            | 0.042623565 |
|    clip_fraction        | 0.491       |
|    clip_range           | 0.2         |
|    entropy_loss         | -21.8       |
|    explained_variance   | 0.573       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.545      |
|    n_updates            | 1230        |
|    policy_gradient_loss | -0.0982     |
|    std                  | 2.75        |
|    value_loss           | 0.0266      |
-----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 175         |
|    iterations           | 7           |
|    time_elapsed         | 81          |
|    total_timesteps      | 14336       |
| train/                  |             |
|    approx_kl            | 0.037964568 |
|    clip_fraction        | 0.453       |
|    clip_range           | 0.2         |
|    entropy_loss         | -21.9       |
|    explained_variance   | 0.462       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.512      |
|    n_updates            | 1245        |
|    policy_gradient_loss | -0.0764     |
|    std                  | 2.77        |
|    value_loss           | 0.0601      |
-----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 175         |
|    iterations           | 8           |
|    time_elapsed         | 93          |
|    total_timesteps      | 16384       |
| train/                  |             |
|    approx_kl            | 0.050668206 |
|    clip_fraction        | 0.504       |
|    clip_range           | 0.2         |
|    entropy_loss         | -22         |
|    explained_variance   | 0.467       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.542      |
|    n_updates            | 1260        |
|    policy_gradient_loss | -0.107      |
|    std                  | 2.8         |
|    value_loss           | 0.0406      |
-----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 176        |
|    iterations           | 9          |
|    time_elapsed         | 104        |
|    total_timesteps      | 18432      |
| train/                  |            |
|    approx_kl            | 0.05970875 |
|    clip_fraction        | 0.561      |
|    clip_range           | 0.2        |
|    entropy_loss         | -22        |
|    explained_variance   | 0.736      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.567     |
|    n_updates            | 1275       |
|    policy_gradient_loss | -0.111     |
|    std                  | 2.81       |
|    value_loss           | 0.0214     |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 175        |
|    iterations           | 10         |
|    time_elapsed         | 116        |
|    total_timesteps      | 20480      |
| train/                  |            |
|    approx_kl            | 0.04228936 |
|    clip_fraction        | 0.503      |
|    clip_range           | 0.2        |
|    entropy_loss         | -22.1      |
|    explained_variance   | 0.719      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.559     |
|    n_updates            | 1290       |
|    policy_gradient_loss | -0.102     |
|    std                  | 2.83       |
|    value_loss           | 0.0222     |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 174        |
|    iterations           | 11         |
|    time_elapsed         | 129        |
|    total_timesteps      | 22528      |
| train/                  |            |
|    approx_kl            | 0.05764263 |
|    clip_fraction        | 0.546      |
|    clip_range           | 0.2        |
|    entropy_loss         | -22.2      |
|    explained_variance   | 0.568      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.533     |
|    n_updates            | 1305       |
|    policy_gradient_loss | -0.086     |
|    std                  | 2.87       |
|    value_loss           | 0.0518     |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 173        |
|    iterations           | 12         |
|    time_elapsed         | 141        |
|    total_timesteps      | 24576      |
| train/                  |            |
|    approx_kl            | 0.04765893 |
|    clip_fraction        | 0.511      |
|    clip_range           | 0.2        |
|    entropy_loss         | -22.3      |
|    explained_variance   | 0.276      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.552     |
|    n_updates            | 1320       |
|    policy_gradient_loss | -0.102     |
|    std                  | 2.88       |
|    value_loss           | 0.0274     |
----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 173         |
|    iterations           | 13          |
|    time_elapsed         | 153         |
|    total_timesteps      | 26624       |
| train/                  |             |
|    approx_kl            | 0.048455507 |
|    clip_fraction        | 0.53        |
|    clip_range           | 0.2         |
|    entropy_loss         | -22.4       |
|    explained_variance   | 0.604       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.567      |
|    n_updates            | 1335        |
|    policy_gradient_loss | -0.106      |
|    std                  | 2.93        |
|    value_loss           | 0.0275      |
-----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 173        |
|    iterations           | 14         |
|    time_elapsed         | 165        |
|    total_timesteps      | 28672      |
| train/                  |            |
|    approx_kl            | 0.06950668 |
|    clip_fraction        | 0.574      |
|    clip_range           | 0.2        |
|    entropy_loss         | -22.5      |
|    explained_variance   | 0.479      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.562     |
|    n_updates            | 1350       |
|    policy_gradient_loss | -0.105     |
|    std                  | 2.95       |
|    value_loss           | 0.0549     |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 173        |
|    iterations           | 15         |
|    time_elapsed         | 177        |
|    total_timesteps      | 30720      |
| train/                  |            |
|    approx_kl            | 0.05555522 |
|    clip_fraction        | 0.56       |
|    clip_range           | 0.2        |
|    entropy_loss         | -22.6      |
|    explained_variance   | 0.723      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.572     |
|    n_updates            | 1365       |
|    policy_gradient_loss | -0.101     |
|    std                  | 3          |
|    value_loss           | 0.0195     |
----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 171         |
|    iterations           | 16          |
|    time_elapsed         | 190         |
|    total_timesteps      | 32768       |
| train/                  |             |
|    approx_kl            | 0.048671223 |
|    clip_fraction        | 0.542       |
|    clip_range           | 0.2         |
|    entropy_loss         | -22.7       |
|    explained_variance   | 0.738       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.566      |
|    n_updates            | 1380        |
|    policy_gradient_loss | -0.106      |
|    std                  | 3.03        |
|    value_loss           | 0.0279      |
-----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 171        |
|    iterations           | 17         |
|    time_elapsed         | 203        |
|    total_timesteps      | 34816      |
| train/                  |            |
|    approx_kl            | 0.07863188 |
|    clip_fraction        | 0.545      |
|    clip_range           | 0.2        |
|    entropy_loss         | -22.8      |
|    explained_variance   | 0.635      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.55      |
|    n_updates            | 1395       |
|    policy_gradient_loss | -0.101     |
|    std                  | 3.04       |
|    value_loss           | 0.0552     |
----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 170         |
|    iterations           | 18          |
|    time_elapsed         | 215         |
|    total_timesteps      | 36864       |
| train/                  |             |
|    approx_kl            | 0.050403178 |
|    clip_fraction        | 0.505       |
|    clip_range           | 0.2         |
|    entropy_loss         | -22.9       |
|    explained_variance   | 0.207       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.562      |
|    n_updates            | 1410        |
|    policy_gradient_loss | -0.101      |
|    std                  | 3.1         |
|    value_loss           | 0.0419      |
-----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 169        |
|    iterations           | 19         |
|    time_elapsed         | 228        |
|    total_timesteps      | 38912      |
| train/                  |            |
|    approx_kl            | 0.05946914 |
|    clip_fraction        | 0.567      |
|    clip_range           | 0.2        |
|    entropy_loss         | -23        |
|    explained_variance   | 0.564      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.57      |
|    n_updates            | 1425       |
|    policy_gradient_loss | -0.107     |
|    std                  | 3.14       |
|    value_loss           | 0.039      |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 170        |
|    iterations           | 20         |
|    time_elapsed         | 240        |
|    total_timesteps      | 40960      |
| train/                  |            |
|    approx_kl            | 0.06797266 |
|    clip_fraction        | 0.59       |
|    clip_range           | 0.2        |
|    entropy_loss         | -23.2      |
|    explained_variance   | 0.738      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.583     |
|    n_updates            | 1440       |
|    policy_gradient_loss | -0.111     |
|    std                  | 3.2        |
|    value_loss           | 0.0329     |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 170        |
|    iterations           | 21         |
|    time_elapsed         | 252        |
|    total_timesteps      | 43008      |
| train/                  |            |
|    approx_kl            | 0.06874631 |
|    clip_fraction        | 0.639      |
|    clip_range           | 0.2        |
|    entropy_loss         | -23.3      |
|    explained_variance   | 0.663      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.575     |
|    n_updates            | 1455       |
|    policy_gradient_loss | -0.112     |
|    std                  | 3.26       |
|    value_loss           | 0.0398     |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 170        |
|    iterations           | 22         |
|    time_elapsed         | 264        |
|    total_timesteps      | 45056      |
| train/                  |            |
|    approx_kl            | 0.05217287 |
|    clip_fraction        | 0.538      |
|    clip_range           | 0.2        |
|    entropy_loss         | -23.4      |
|    explained_variance   | 0.581      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.576     |
|    n_updates            | 1470       |
|    policy_gradient_loss | -0.112     |
|    std                  | 3.27       |
|    value_loss           | 0.0434     |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 169        |
|    iterations           | 23         |
|    time_elapsed         | 277        |
|    total_timesteps      | 47104      |
| train/                  |            |
|    approx_kl            | 0.06626767 |
|    clip_fraction        | 0.56       |
|    clip_range           | 0.2        |
|    entropy_loss         | -23.5      |
|    explained_variance   | 0.431      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.561     |
|    n_updates            | 1485       |
|    policy_gradient_loss | -0.0941    |
|    std                  | 3.34       |
|    value_loss           | 0.0475     |
----------------------------------------
--------------------------------------
| time/                   |          |
|    fps                  | 169      |
|    iterations           | 24       |
|    time_elapsed         | 290      |
|    total_timesteps      | 49152    |
| train/                  |          |
|    approx_kl            | 0.066824 |
|    clip_fraction        | 0.587    |
|    clip_range           | 0.2      |
|    entropy_loss         | -23.7    |
|    explained_variance   | 0.512    |
|    learning_rate        | 0.00025  |
|    loss                 | -0.584   |
|    n_updates            | 1500     |
|    policy_gradient_loss | -0.11    |
|    std                  | 3.4      |
|    value_loss           | 0.0472   |
--------------------------------------
---------------------------------------
| time/                   |           |
|    fps                  | 168       |
|    iterations           | 25        |
|    time_elapsed         | 303       |
|    total_timesteps      | 51200     |
| train/                  |           |
|    approx_kl            | 0.0606414 |
|    clip_fraction        | 0.572     |
|    clip_range           | 0.2       |
|    entropy_loss         | -23.9     |
|    explained_variance   | 0.559     |
|    learning_rate        | 0.00025   |
|    loss                 | -0.591    |
|    n_updates            | 1515      |
|    policy_gradient_loss | -0.106    |
|    std                  | 3.5       |
|    value_loss           | 0.0304    |
---------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 169         |
|    iterations           | 26          |
|    time_elapsed         | 313         |
|    total_timesteps      | 53248       |
| train/                  |             |
|    approx_kl            | 0.048922792 |
|    clip_fraction        | 0.489       |
|    clip_range           | 0.2         |
|    entropy_loss         | -24.1       |
|    explained_variance   | 0.543       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.569      |
|    n_updates            | 1530        |
|    policy_gradient_loss | -0.088      |
|    std                  | 3.55        |
|    value_loss           | 0.0405      |
-----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 170        |
|    iterations           | 27         |
|    time_elapsed         | 324        |
|    total_timesteps      | 55296      |
| train/                  |            |
|    approx_kl            | 0.26826736 |
|    clip_fraction        | 0.657      |
|    clip_range           | 0.2        |
|    entropy_loss         | -24.2      |
|    explained_variance   | 0.567      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.582     |
|    n_updates            | 1545       |
|    policy_gradient_loss | -0.111     |
|    std                  | 3.6        |
|    value_loss           | 0.0695     |
----------------------------------------
----------------------------------------
| time/                   |            |
|    fps                  | 170        |
|    iterations           | 28         |
|    time_elapsed         | 336        |
|    total_timesteps      | 57344      |
| train/                  |            |
|    approx_kl            | 0.04843151 |
|    clip_fraction        | 0.491      |
|    clip_range           | 0.2        |
|    entropy_loss         | -24.4      |
|    explained_variance   | 0.369      |
|    learning_rate        | 0.00025    |
|    loss                 | -0.572     |
|    n_updates            | 1560       |
|    policy_gradient_loss | -0.0898    |
|    std                  | 3.65       |
|    value_loss           | 0.068      |
----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 170         |
|    iterations           | 29          |
|    time_elapsed         | 347         |
|    total_timesteps      | 59392       |
| train/                  |             |
|    approx_kl            | 0.059620287 |
|    clip_fraction        | 0.571       |
|    clip_range           | 0.2         |
|    entropy_loss         | -24.5       |
|    explained_variance   | 0.527       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.605      |
|    n_updates            | 1575        |
|    policy_gradient_loss | -0.109      |
|    std                  | 3.7         |
|    value_loss           | 0.0336      |
-----------------------------------------
-----------------------------------------
| time/                   |             |
|    fps                  | 171         |
|    iterations           | 30          |
|    time_elapsed         | 359         |
|    total_timesteps      | 61440       |
| train/                  |             |
|    approx_kl            | 0.081700295 |
|    clip_fraction        | 0.581       |
|    clip_range           | 0.2         |
|    entropy_loss         | -24.7       |
|    explained_variance   | 0.448       |
|    learning_rate        | 0.00025     |
|    loss                 | -0.577      |
|    n_updates            | 1590        |
|    policy_gradient_loss | -0.0815     |
|    std                  | 3.8         |
|    value_loss           | 0.0709      |
-----------------------------------------
Traceback (most recent call last):
  File "autocalc_cpdrl.py", line 453, in <module>
    if patience_counter >= patience:
  File "autocalc_cpdrl.py", line 431, in main
    intervention_idx=idx+1,
  File "autocalc_cpdrl.py", line 314, in ppo_train_on_intervention
    else:
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/stable_baselines3/ppo/ppo.py", line 308, in learn
    reset_num_timesteps=reset_num_timesteps,
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/stable_baselines3/common/on_policy_algorithm.py", line 270, in learn
    self.train()
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/stable_baselines3/ppo/ppo.py", line 199, in train
    values, log_prob, entropy = self.policy.evaluate_actions(rollout_data.observations, actions)
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/stable_baselines3/common/policies.py", line 645, in evaluate_actions
    distribution = self._get_action_dist_from_latent(latent_pi)
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/stable_baselines3/common/policies.py", line 607, in _get_action_dist_from_latent
    return self.action_dist.proba_distribution(mean_actions, self.log_std)
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/stable_baselines3/common/distributions.py", line 152, in proba_distribution
    self.distribution = Normal(mean_actions, action_std)
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/torch/distributions/normal.py", line 51, in __init__
    self.loc, self.scale = broadcast_all(loc, scale)
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/torch/distributions/utils.py", line 40, in broadcast_all
    return torch.broadcast_tensors(*values)
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/torch/functional.py", line 72, in broadcast_tensors
    if has_torch_function(tensors):
KeyboardInterrupt
