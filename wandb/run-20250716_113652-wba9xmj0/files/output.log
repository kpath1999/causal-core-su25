
==================================================
starting meta-rl teacher-student training
   task: pushing
   meta-episodes: 10
   student training steps: 10000
==================================================
INFO:root:Loaded student PPO from ppo_pushing_sb3/final_model.zip

==================================================
initial evaluation
==================================================

evaluating student performance (5 episodes)...
episode 1: length=27, reward=-0.773, success=True
episode 2: length=27, reward=-0.773, success=True
episode 3: length=27, reward=-0.773, success=True
performance summary:
success rate: 1.000 (5/5)
average reward: -0.773
average episode length: 27.0
initial student success rate: 1.000
Computing teacher state (CM scores for all interventions)...
Processing intervention 1/6: goal
IntervenedCausalWorld created with goal intervention
Evaluating CM score for goal intervention...
Reset #1: goal intervention applied (success: True)
episode 1: 501 steps, reward: 3.078
Reset #2: goal intervention applied (success: True)
episode 2: 501 steps, reward: 0.039
Reset #3: goal intervention applied (success: True)
episode 3: 501 steps, reward: 1.888
total data points collected: 2505
average episode length: 501.0
average episode reward: 1.207
termination reasons: ['max_length', 'max_length', 'max_length', 'max_length', 'max_length']
success rate: 0/5
meta_teacher_student.py:227: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at ../torch/csrc/utils/tensor_new.cpp:230.)
  states = torch.tensor([d[0] for d in data], dtype=torch.float32).to(device)
tensor shapes - states: torch.Size([2505, 56]), actions: torch.Size([2505, 9])
Creating ensembles (obs_dim=56, act_dim=9, hidden_dim=64)
Training transition models...
Transition model losses: ['7.4553', '7.8204', '7.3470', '7.0077', '7.6039']
Training reward models...
Reward model losses: ['0.3503', '0.1899', '0.0223', '0.9518', '0.0046']
Training state VAE models...
State VAE losses: ['152221.0344', '117240.6141', '71164.7233', '270286.6962', '307002.3050']
Training action VAE models...
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
Action VAE losses: ['inf', 'inf', 'inf', 'inf', 'inf']
CM score components:
transition disagreement: 0.3879
reward disagreement: 0.3452
state disagreement: 0.6897
action disagreement: nan
total CM score: nan
goal is complete. CM score: nan
Processing intervention 2/6: mass
IntervenedCausalWorld created with mass intervention
Evaluating CM score for mass intervention...
Reset #1: mass intervention applied (success: True)
episode 1: 501 steps, reward: 4.514
Reset #2: mass intervention applied (success: True)
episode 2: 501 steps, reward: 4.913
Reset #3: mass intervention applied (success: True)
episode 3: 501 steps, reward: 4.497
total data points collected: 2505
average episode length: 501.0
average episode reward: 4.392
termination reasons: ['success', 'success', 'success', 'success', 'max_length']
success rate: 4/5
tensor shapes - states: torch.Size([2505, 56]), actions: torch.Size([2505, 9])
Creating ensembles (obs_dim=56, act_dim=9, hidden_dim=64)
Training transition models...
Transition model losses: ['7.2346', '6.9808', '7.6331', '7.4808', '7.8795']
Training reward models...
Reward model losses: ['0.1229', '0.0236', '0.0047', '0.0676', '0.0269']
Training state VAE models...
State VAE losses: ['344474.0588', '145299.3028', '107908.4731', '87360.4478', '96935.5528']
Training action VAE models...
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
nan detected in action vae training - skipping iteration
Action VAE losses: ['inf', 'inf', 'inf', 'inf', 'inf']
CM score components:
transition disagreement: 0.4289
reward disagreement: 0.1058
state disagreement: 0.6385
action disagreement: nan
total CM score: nan
mass is complete. CM score: nan
Processing intervention 3/6: friction
IntervenedCausalWorld created with friction intervention
Evaluating CM score for friction intervention...
Reset #1: friction intervention applied (success: True)
episode 1: 501 steps, reward: 4.469
Reset #2: friction intervention applied (success: True)
episode 2: 501 steps, reward: 3.387
Reset #3: friction intervention applied (success: True)
Traceback (most recent call last):
  File "meta_teacher_student.py", line 645, in <module>
    main()
  File "meta_teacher_student.py", line 607, in main
    S_teacher = get_teacher_state(student_model, args.task, INTERVENTIONS, device=device, seed=args.seed)
  File "meta_teacher_student.py", line 363, in get_teacher_state
    cm_score = evaluate_cm_score(intervened_env, student_model, device=device, intervention_type=intervention['type'])
  File "meta_teacher_student.py", line 200, in evaluate_cm_score
    next_obs, rew, done, info = env.step(act)
  File "meta_teacher_student.py", line 167, in step
    return self.base_env.step(action)
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/causal_world/envs/causalworld.py", line 274, in step
    observation = self._task.filter_structured_observations()
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/causal_world/task_generators/base_task.py", line 902, in filter_structured_observations
    np.array(self._current_full_observations_dict[key]))
  File "<__array_function__ internals>", line 6, in append
  File "/home/kpatherya3/anaconda3/envs/causal_env/lib/python3.7/site-packages/numpy/lib/function_base.py", line 4762, in append
    @array_function_dispatch(_append_dispatcher)
KeyboardInterrupt
